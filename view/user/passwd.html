{% extends "layout/main.html" %}
{% block title %}修改密码{% endblock %}
{% block body %}
<div class="row mt-4 mb-3">
    <h5>修改密码</h5>
</div>
<form class="pr-5 pl-5">
    <div class="form-group row">
        <label for="username" class="col-sm-1 col-form-label">用户名</label>
        <div class="col-sm-5">
            <input type="text" readonly class="form-control-plaintext" id="username" value="{{ handler.session.data.username }}">
        </div>
    </div>
    <div class="form-group row">
        <label for="password0" class="col-sm-1 col-form-label">原始密码</label>
        <div class="col-sm-5">
            <input type="password" class="form-control" id="password0">
        </div>
        <div class="col-sm-1" style="margin-top: 6px"><i class="fa fa-asterisk" style="color: red;font-size: 10px"></i></div>
    </div>
    <div class="form-group row">
        <label for="password" class="col-sm-1 col-form-label">新密码</label>
        <div class="col-sm-5">
            <input type="password" class="form-control" id="password">
        </div>
        <div class="col-sm-1" style="margin-top: 6px"><i class="fa fa-asterisk" style="color: red;font-size: 10px"></i></div>
    </div>
    <div class="form-group row">
        <label for="password2" class="col-sm-1 col-form-label">确认密码</label>
        <div class="col-sm-5">
            <input type="password" class="form-control" id="password2">
        </div>
        <div class="col-sm-1" style="margin-top: 6px"><i class="fa fa-asterisk" style="color: red;font-size: 10px"></i></div>
    </div>
    <div class="form-group row">
        <div class="col-sm-4"></div>
        <div class="col-sm-2 text-right"><button type="button" class="btn btn-outline-dark" id="passwdBtn"><i class="fa fa-fw fa-save"></i> 保 存</button></div>
    </div>
</form>
{% endblock %}
{% block footer %}
<script>
$(function () {

    //保存
    $('#passwdBtn').click(function () {
        var password0 = $('#password0').val().trim(),
            password = $('#password').val().trim(),
            password2 = $('#password2').val().trim();
        if (password0==='') {
            layer.msg('请输入原始密码！');
            $('#password0').focus();
            return false;
        }
        if (password==='') {
            layer.msg('请输入新密码！');
            $('#password').focus();
            return false;
        }
        if (password2==='') {
            layer.msg('请再次输入新密码！');
            $('#password2').focus();
            return false;
        }
        if (password0===password) {
            layer.msg('新旧密码相同，请重新输入！');
            $('#password0').val('');
            $('#password').val('');
            $('#password2').val('');
            $('#password0').focus();
            return false;
        }
        if (password!==password2) {
            layer.msg('两次新密码输入不一致，请重新输入！');
            $('#password').val('');
            $('#password2').val('');
            $('#password').focus();
            return false;
        }
        $.ajax({
            type: "POST",
            url: "/user/passwd",
            data: {password0:password0,password:password,password2:password2},
            dataType: "json",
            success: function (resp) {
                var code = resp['code'],
                    msg = resp['msg'];
                if (code === 0) {
                    layer.alert(msg, {title: '密码修改提示', icon: 1});
                    $('#password0').val('');
                    $('#password').val('');
                    $('#password2').val('');
                } else if (code < 0) {
                    layer.msg(msg);
                } else {
                    layer.alert('修改密码失败，请稍后再试！', {title: 'KvMan提示', icon: 3});
                }
            },
            error: function () {
                layer.alert('系统繁忙，请稍后再试！', {title: 'KvMan提示', icon: 3});
            }
        });
    });

});
</script>
{% endblock %}